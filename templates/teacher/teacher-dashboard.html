
{% load static %}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - AI Study Platform</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="dashboard-styles.css"> -->

      <link rel="stylesheet" href="{% static 'dashboard-styles.css' %}">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- <script src="{% static 'dashboard-script.js' %}"></script> -->

    <style>
        /* Teacher-specific styles */
        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.05) 0%, rgba(108, 117, 125, 0.05) 100%);
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(108, 117, 125, 0.1) 100%);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin-bottom: 1.5rem;
        }

        .btn-upload {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(13, 110, 253, 0.3);
            color: white;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.uploads {
            background: linear-gradient(135deg, var(--success-color) 0%, #66bb6a 100%);
        }

        .stat-icon.students {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .stat-icon.materials {
            background: linear-gradient(135deg, var(--warning-color) 0%, #ffb74d 100%);
        }

        .stat-details h3 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .stat-details p {
            margin: 0;
            color: #6c757d;
            font-weight: 500;
        }

        .teacher-dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: none;
            margin-bottom: 2rem;
        }

        .teacher-dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }

        .teacher-card-header {
            border: none;
            background: none;
            padding: 0 0 1.5rem 0;
        }

        .teacher-card-title {
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .teacher-card-title i {
            margin-right: 0.75rem;
            color: var(--primary-color);
        }

        /* Welcome section to match student dashboard */
        .welcome-section {
            background: linear-gradient(135deg, var(--primary-color), #4c84ff);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }

        /* Navigation link highlighting */
        .nav-link.clicked {
            background-color: rgba(255, 255, 255, 0.1) !important;
            border-radius: 5px;
            transform: scale(1.05);
            transition: all 0.3s ease;
            color: white !important;
            font-weight: bold !important;
        }

        .nav-link.clicked i {
            color: white !important;
            font-weight: 900 !important;
        }

        /* Highlighted title styling */
        .highlighted-title {
            background: linear-gradient(135deg, var(--primary-color), #4c84ff);
            color: white !important;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600 !important;
            text-align: center;
            box-shadow: 0 2px 8px rgba(13, 110, 253, 0.3);
            margin-bottom: 1rem !important;
        }

        /* Student Performance Table Styling */
        .table {
            margin-bottom: 0;
        }

        .table th {
            border-top: none;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            vertical-align: middle;
            padding: 1rem 0.75rem;
        }

        .student-avatar {
            font-size: 1.5rem;
        }

        .table-hover tbody tr:hover {
            background-color: rgba(13, 110, 253, 0.05);
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.5em 0.75em;
        }
    </style>
</head>
<body>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  


    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-graduation-cap me-2"></i>
                Personalized AI-Powered Learning Platform
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="handleAbout()"><i class="fas fa-info-circle me-1"></i>About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="handleFeedback()"><i class="fas fa-comment-dots me-1"></i>Feedback</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="handleDeveloper()"><i class="fas fa-code me-1"></i>Developer</a>
                    </li>
                </ul>
                <div class="navbar-nav">
                    <div class="nav-item me-3">
                        <a class="nav-link" href="#" title="Toggle Dark Mode" onclick="toggleDarkMode()">
                            <i class="fas fa-moon text-light" id="darkModeToggle"></i>
                        </a>
                    </div>
                    <div class="nav-item me-3">
                        <a class="nav-link" href="#" title="Notifications" onclick="showNotifications()" id="notificationBell">
                            <i class="fas fa-bell position-relative text-warning">
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6em;" id="notificationCount">
                                    3
                                </span>
                            </i>
                        </a>
                    </div>
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle text-light"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <!-- Content Container -->
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="sidebar">
                        <div class="sidebar-content">
                            <h6 class="sidebar-title highlighted-title">Quick Actions</h6>
                            <div class="list-group">
                                <a href="#" class="list-group-item list-group-item-action" onclick="showUploadModal()">
                                    <i class="fas fa-upload me-2"></i>Upload Materials
                                </a>
                              
                                <a href="#" class="list-group-item list-group-item-action">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9">
                    <!-- Welcome Section -->
                    <div class="welcome-section mb-4">
                        <h2 class="welcome-title">Welcome back, Teacher! 👋</h2>
                        <p class="welcome-subtitle">Ready to share knowledge and inspire students today?</p>
                    </div>
                    <!-- Quick Stats -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="stat-icon uploads">
                                <i class="fas fa-upload"></i>
                            </div>
                            <div class="stat-details">
                                <h3>24</h3>
                                <p>Materials Uploaded</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon students">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-details">
                                <h3>156</h3>
                                <p>Active Students</p>
                            </div>
                        </div>
                        <!-- <div class="stat-card">
                            <div class="stat-icon materials">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-details">
                                <h3>8</h3>
                                <p>Courses</p>
                            </div>
                        </div> -->
                    </div>

                    <!-- Student Performance Table -->
                    <div class="teacher-dashboard-card mt-4">
                        <div class="teacher-card-header">
                            <h3 class="teacher-card-title">
                                <i class="fas fa-chart-line"></i>
                                Student Performance Overview
                            </h3>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-primary">
                                    <tr>
                                        <th scope="col">Student ID</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Quizzes Attempted</th>
                                        <th scope="col">Avg. Score</th>
                                        <th scope="col">Recent Weak Topics</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    
                                    <tr>
                                        <td class="fw-bold text-primary">STU003</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="student-avatar me-2">
                                                    <i class="fas fa-user-circle text-secondary"></i>
                                                </div>
                                                Michael Brown
                                            </div>
                                        </td>
                                        <td>
                                            <span class="">8</span>
                                        </td>
                                        <td>
                                            <span class="">74%</span>
                                        </td>
                                        <td>
                                            <span class="text-black">Algebra,</span>
                                            <span class="text-black">Statistics,</span>
                                            <span class="text-black">Probability</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold text-primary">STU004</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="student-avatar me-2">
                                                    <i class="fas fa-user-circle text-secondary"></i>
                                                </div>
                                                Emily Davis
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">18</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-success">95%</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-secondary">None</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold text-primary">STU005</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="student-avatar me-2">
                                                    <i class="fas fa-user-circle text-secondary"></i>
                                                </div>
                                                David Wilson
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">10</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-warning">78%</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-warning text-dark me-1">Chemistry</span>
                                            <span class="badge bg-warning text-dark">Equations</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold text-primary">STU006</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="student-avatar me-2">
                                                    <i class="fas fa-user-circle text-secondary"></i>
                                                </div>
                                                Lisa Anderson
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">14</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-success">89%</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-warning text-dark">Geometry</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-eye me-2"></i>View All Students
                            </button>
                            <button class="btn btn-outline-success ms-2" onclick="exportToExcel()">
                                <i class="fas fa-download me-2"></i>Export Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Materials Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadModalLabel">
                        <i class="fas fa-cloud-upload-alt me-2"></i>Upload Learning Materials
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body"> 


                    <form class="mt-4" id="uploadForm" enctype="multipart/form-data">

                    <div class="upload-area" onclick="document.getElementById('modalFileInput').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            <p><strong>Drag and drop</strong> your files here or <strong>click to browse</strong></p>
                            <p class="text-muted">Support for PDF, PPT, DOC, and video files</p>
                        </div>
                        <button type="button" class="btn btn-upload">
                            <i class="fas fa-plus me-2"></i>Choose Files
                        </button>
                        <input type="file" name="file" class="form-control d-none" id="modalFileInput" required>
                    </div>
                    
                    
                        <div class="mb-3">
                            <label class="form-label">Material Title</label>
                            <input type="text" name="title" id="title" class="form-control" placeholder="Enter material title" required>
                        </div>

                         <div class="mb-3">
                            <label class="form-label">Material type</label>
                            <select class="form-select" name="type" id="doc_type" required>
                                <option value="" disabled selected>Select material type</option>
                                <option value="syllabus">Syllabus</option>
                                <option value="curriculum">Curriculum</option>
                                <option value="notes">Reference/Notes</option>
                               
                            </select>
                        </div>

                        <input type="text" name="course" style="display: none;" value="1">
                        <input type="text" name="teacher" style="display: none;" value="1">
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="uploadForm" class="btn btn-upload">
                        <i class="fas fa-upload me-2"></i>Upload Material
                    </button>
                </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap and Custom Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom Dashboard Script -->
    <!-- <script src="dashboard-script.js"></script> -->

 
    
    <script>
        // Teacher dashboard specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize teacher-specific features
            initializeTeacherDashboard();
        });

        function initializeTeacherDashboard() {
            // Initialize modal upload area
            initializeModalUploadArea();
            
            // Initialize upload form
            initializeUploadForm();
        }

        function initializeModalUploadArea() {
            const uploadArea = document.querySelector('#uploadModal .upload-area');
            const fileInput = document.getElementById('modalFileInput');
            
            if (uploadArea && fileInput) {
                // Drag and drop functionality
                uploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#6c757d';
                    uploadArea.style.backgroundColor = 'rgba(13, 110, 253, 0.15)';
                });

                uploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#0d6efd';
                    uploadArea.style.backgroundColor = 'rgba(13, 110, 253, 0.05)';
                });

                uploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#0d6efd';
                    uploadArea.style.backgroundColor = 'rgba(13, 110, 253, 0.05)';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        alert(`${files.length} file(s) selected for upload`, 'success');
                    }
                });

                // File input change handler
                fileInput.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        alert(`${this.files.length} file(s) selected for upload`, 'success');
                    }
                });
            }
        }

        function initializeUploadForm() {
            // Form submission handler
            const uploadForm = document.getElementById('uploadForm');
            if (uploadForm) {
                uploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();


                    
                    // Check if title is provided
                    const titleInput = this.querySelector('input[type="text"]');
                    if (!titleInput.value.trim()) {
                        alert('Please enter a material title', 'warning');
                        return;
                    }

                    const docType = document.getElementById('doc_type');





                    // Check if files are selected
                    const fileInput = document.getElementById('modalFileInput');
                    if (!fileInput.files.length) {
                        alert('Please select files to upload', 'warning');
                        return;

 
                    }

                    let formData = new FormData(uploadForm);
                    const modal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));

                    async function pp(){


                        try{


                        const responce = await $.ajax({


                            url: "{% url 'teacher:upload' %}",
                            type: 'POST',
                            data: formData,
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            processData: false,
                            contentType: false,
                            




                        });


                        return "uploaded"


                    }
                    catch(err){

                        console.log(err)


                    }


                    }

                    async function rr(){

                        const res = await pp();

                        if(res == "uploaded"){

                            alert(`"${titleInput.value}" uploaded successfully! Students will be notified.`, 'success');

                            modal.hide();
                    
                            uploadForm.reset();
                            document.getElementById('modalFileInput').value = '';

                        }
                        else{
                            alert('Upload failed. Please try again.', 'danger');
                        }
                    }

                    rr();





                    
                    
                    // Close modal
                   
                    
                    
                    // Show success notification
                    // alert(`"${titleInput.value}" uploaded successfully! Students will be notified.`, 'success');
                    
                    // Reset form
                    
                });
            }
        }

        // Function to show upload modal
        function showUploadModal() {
            const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
            uploadModal.show();
        }

        // Teacher-specific notifications function - override the default notifications
        function showNotifications() {
            // Close any existing notification popup
            const existingPopup = document.querySelector('.notification-popup');
            if (existingPopup) {
                existingPopup.remove();
                return;
            }

            // Teacher-specific notification data
            const notifications = [
                {
                    id: 1,
                    type: 'success',
                    icon: 'fa-user-plus',
                    title: 'New Student Enrolled',
                    message: 'John Smith has enrolled in your Advanced Mathematics course.',
                    time: '15 minutes ago',
                    read: false
                },
                {
                    id: 2,
                    type: 'info',
                    icon: 'fa-upload',
                    title: 'Material Upload Complete',
                    message: 'Your "Linear Algebra Chapter 5" has been successfully processed and is now live.',
                    time: '1 hour ago',
                    read: false
                },
                {
                    id: 3,
                    type: 'warning',
                    icon: 'fa-chart-bar',
                    title: 'Quiz Results Available',
                    message: '15 students completed Physics Quiz #3. Average score: 85%. View detailed analytics.',
                    time: '2 hours ago',
                    read: false
                },
                {
                    id: 4,
                    type: 'info',
                    icon: 'fa-comments',
                    title: 'Student Question',
                    message: 'Sarah Johnson asked a question about derivatives in the Q&A section.',
                    time: '4 hours ago',
                    read: true
                },
                {
                    id: 5,
                    type: 'success',
                    icon: 'fa-star',
                    title: 'Course Rating',
                    message: 'Your Machine Learning course received a 5-star rating from Michael Brown.',
                    time: '1 day ago',
                    read: true
                }
            ];

            // Create notification popup
            const notificationPopup = document.createElement('div');
            notificationPopup.className = 'notification-popup';
            
            notificationPopup.innerHTML = `
                <div class="notification-header">
                    <h6 class="mb-0">
                        <i class="fas fa-bell me-2"></i>Notifications
                        <span class="notification-count">${notifications.filter(n => !n.read).length}</span>
                    </h6>
                    <div class="notification-actions">
                        <button class="btn-mark-all-read" onclick="markAllAsRead()" title="Mark all as read">
                            <i class="fas fa-check-double"></i>
                        </button>
                        <button class="btn-close-notifications" onclick="closeNotifications()" title="Close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="notification-body">
                    ${notifications.map(notification => `
                        <div class="notification-item ${notification.read ? 'read' : 'unread'}" data-id="${notification.id}">
                            <div class="notification-icon ${notification.type}">
                                <i class="fas ${notification.icon}"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">${notification.title}</div>
                                <div class="notification-message">${notification.message}</div>
                                <div class="notification-time">${notification.time}</div>
                            </div>
                            ${!notification.read ? '<div class="notification-dot"></div>' : ''}
                        </div>
                    `).join('')}
                </div>
                <div class="notification-footer">
                    <button class="btn-view-all" onclick="viewAllNotifications()">
                        View All Notifications
                    </button>
                </div>
            `;

            // Position and show popup
            const notificationBell = document.getElementById('notificationBell');
            const rect = notificationBell.getBoundingClientRect();
            
            notificationPopup.style.position = 'fixed';
            notificationPopup.style.top = (rect.bottom + 10) + 'px';
            notificationPopup.style.right = '20px';
            notificationPopup.style.zIndex = '9999';
            
            document.body.appendChild(notificationPopup);

            // Add click handlers for notification items
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const id = this.dataset.id;
                    markAsRead(id);
                });
            });

            // Close popup when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeOnOutside(e) {
                    if (!notificationPopup.contains(e.target) && !notificationBell.contains(e.target)) {
                        notificationPopup.remove();
                        document.removeEventListener('click', closeOnOutside);
                    }
                });
            }, 100);
        }

        // Helper functions for notifications
        function closeNotifications() {
            const popup = document.querySelector('.notification-popup');
            if (popup) popup.remove();
        }

        function markAllAsRead() {
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
                item.classList.add('read');
                const dot = item.querySelector('.notification-dot');
                if (dot) dot.remove();
            });
            
            // Update notification count
            const countBadge = document.getElementById('notificationCount');
            if (countBadge) countBadge.textContent = '0';
            
            alert('All notifications marked as read', 'success');
        }

        function markAsRead(id) {
            const item = document.querySelector(`[data-id="${id}"]`);
            if (item && item.classList.contains('unread')) {
                item.classList.remove('unread');
                item.classList.add('read');
                const dot = item.querySelector('.notification-dot');
                if (dot) dot.remove();
                
                // Update count
                const unreadCount = document.querySelectorAll('.notification-item.unread').length;
                const countBadge = document.getElementById('notificationCount');
                if (countBadge) countBadge.textContent = unreadCount;
            }
        }

        function viewAllNotifications() {
            closeNotifications();
            alert('Opening full notifications page...', 'info');
            // In a real app, this would navigate to a notifications page
        }

        // Navigation highlighting functions
        function highlightNavLink(linkElement) {
            // Remove highlight from all nav links
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.classList.remove('clicked');
            });
            
            // Add highlight to clicked link
            linkElement.classList.add('clicked');
            
            // Remove highlight after 2 seconds
            setTimeout(() => {
                linkElement.classList.remove('clicked');
            }, 2000);
        }

        // Enhanced About and Feedback functions with highlighting
        function handleAbout() {
            const aboutLink = document.querySelector('.nav-link[onclick="handleAbout()"]');
            if (aboutLink) {
                highlightNavLink(aboutLink);
            }
            
            // Show the about modal
            alert('Loading platform information...', 'info');
            setTimeout(() => {
                showAboutModal();
            }, 1000);
        }

        function handleFeedback() {
            const feedbackLink = document.querySelector('.nav-link[onclick="handleFeedback()"]');
            if (feedbackLink) {
                highlightNavLink(feedbackLink);
            }
            
            // Show the feedback modal
            alert('Opening feedback form...', 'info');
            setTimeout(() => {
                showFeedbackModal();
            }, 1000);
        }

        function handleDeveloper() {
            const developerLink = document.querySelector('.nav-link[onclick="handleDeveloper()"]');
            if (developerLink) {
                highlightNavLink(developerLink);
            }
            
            // Show the developer modal
            alert('Loading developer information...', 'info');
            setTimeout(() => {
                showDeveloperModal();
            }, 1000);
        }

        // Developer Modal Function
        function showDeveloperModal() {
            const developerContent = `
                <div class="text-center mb-4">
                    <i class="fas fa-laptop-code text-primary" style="font-size: 3rem;"></i>
                    <h4 class="mt-3">Developer Information</h4>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h5>👨‍💻 Development Team</h5>
                        
                        <!-- Developer 1 Card -->
                        <div class="developer-card mb-3 p-3 border rounded">
                            <div class="d-flex align-items-center">
                                <div class="developer-avatar me-3">
                                    <i class="fas fa-user-tie text-primary" style="font-size: 2rem;"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1 text-primary">Lead Developer</h6>
                                    <p class="mb-1"><strong>Varshith Kuravati</strong></p>
                                    <p class="text-muted mb-0">Full Stack Developer & AI Specialist</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Developer 2 Card -->
                        <div class="developer-card mb-3 p-3 border rounded">
                            <div class="d-flex align-items-center">
                                <div class="developer-avatar me-3">
                                    <i class="fas fa-user-cog text-success" style="font-size: 2rem;"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1 text-success">Data Science Developer</h6>
                                    <p class="mb-1"><strong>Lavan Kumar Konda</strong></p>
                                    <p class="text-muted mb-0">Data Science and Machine Learning Enthusiast</p>
                                </div>
                            </div>
                        </div>
                        
                        <h5>🛠️ Technology Stack</h5>
                        <div class="row mb-3">
                            <div class="col-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="fab fa-html5 text-danger me-2"></i>HTML5</li>
                                    <li class="mb-2"><i class="fab fa-css3-alt text-primary me-2"></i>CSS3</li>
                                    <li class="mb-2"><i class="fab fa-js-square text-warning me-2"></i>JavaScript</li>
                                    <li class="mb-2"><i class="fab fa-bootstrap text-purple me-2"></i>Bootstrap 5</li>
                                </ul>
                            </div>
                            <div class="col-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="fab fa-python text-success me-2"></i>Python</li>
                                    <li class="mb-2"><i class="fas fa-database text-info me-2"></i>Database</li>
                                    <li class="mb-2"><i class="fas fa-robot text-secondary me-2"></i>AI/ML</li>
                                    <li class="mb-2"><i class="fas fa-chart-line text-success me-2"></i>Analytics</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h5>📋 Project Details</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Project Name:</strong></td>
                                    <td>AI-Powered Learning Platform</td>
                                </tr>
                                <tr>
                                    <td><strong>Version:</strong></td>
                                    <td>1.0.0</td>
                                </tr>
                                <tr>
                                    <td><strong>Development Started:</strong></td>
                                    <td>October 2025</td>
                                </tr>
                                <tr>
                                    <td><strong>Framework:</strong></td>
                                    <td>Bootstrap 5 + Custom CSS</td>
                                </tr>
                                <tr>
                                    <td><strong>Features:</strong></td>
                                    <td>AI Tutoring, Student-Teacher Interaction,Quiz generation,Explain to AI,Smart Mentoring</td>
                                </tr>
                            </table>
                        </div>
                        
                        <h5>📞 Contact & Support</h5>
                        
                        <!-- Developer 1 Contact -->
                        <div class="contact-card mb-3 p-3 border rounded bg-light">
                            <h6 class="text-primary mb-2">
                                <i class="fas fa-user-tie me-2"></i>Varshith Kuravati - Lead Developer
                            </h6>
                            <div class="contact-info">
                                <p class="mb-2"><i class="fas fa-envelope text-primary me-2"></i>Email: varshith.dev@example.com</p>
                                <p class="mb-2"><i class="fab fa-github text-dark me-2"></i>GitHub: @varshithkuravati</p>
                                <p class="mb-2"><i class="fab fa-linkedin text-info me-2"></i>LinkedIn: Varshith Kuravati</p>
                                <p class="mb-0"><i class="fas fa-globe text-success me-2"></i>Portfolio: www.varshith-portfolio.com</p>
                            </div>
                        </div>
                        
                        <!-- Developer 2 Contact -->
                        <div class="contact-card mb-3 p-3 border rounded bg-light">6+ 
                            <h6 class="text-success mb-2">
                                <i class="fas fa-user-cog me-2"></i>Lavan Kumar Konda - Data Science Developer
                            </h6>
                            <div class="contact-info">
                                <p class="mb-2"><i class="fas fa-envelope text-primary me-2"></i>Email: lavankumar.dev@example.com</p>
                                <p class="mb-2"><i class="fab fa-github text-dark me-2"></i>GitHub: @lavankumar</p>
                                <p class="mb-2"><i class="fab fa-linkedin text-info me-2"></i>LinkedIn: Lavan kumar Konda</p>
                                <p class="mb-0"><i class="fas fa-globe text-success me-2"></i>Portfolio: www.lavan-portfolio.com</p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-primary me-2" onclick="window.open('mailto:varshith.dev@example.com', '_blank')">
                                <i class="fas fa-envelope me-2"></i>Contact Varshith
                            </button>
                            <button class="btn btn-success me-2" onclick="window.open('mailto:lavankumar.dev@example.com', '_blank')">
                                <i class="fas fa-envelope me-2"></i>Contact Lavan
                            </button>
                            <button class="btn btn-outline-secondary" onclick="alert('Feature request noted! We\\'ll get back to you soon.', 'success')">
                                <i class="fas fa-lightbulb me-2"></i>Request Feature
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('Developer Information', developerContent);
        }

        // Excel Export Function
        function exportToExcel() {
            // Show loading notification
            alert('Preparing Excel report...', 'info');
            
            // Student performance data (in a real app, this would come from your backend/API)
            const studentData = [
                {
                    'Student ID': 'STU001',
                    'Name': 'John Smith',
                    'Quizzes Attempted': 12,
                    'Average Score (%)': 87,
                    'Recent Weak Topics': 'Calculus, Derivatives'
                },
                {
                    'Student ID': 'STU002',
                    'Name': 'Sarah Johnson',
                    'Quizzes Attempted': 15,
                    'Average Score (%)': 92,
                    'Recent Weak Topics': 'Physics'
                },
                {
                    'Student ID': 'STU003',
                    'Name': 'Michael Brown',
                    'Quizzes Attempted': 8,
                    'Average Score (%)': 74,
                    'Recent Weak Topics': 'Algebra, Statistics, Probability'
                },
                {
                    'Student ID': 'STU004',
                    'Name': 'Emily Davis',
                    'Quizzes Attempted': 18,
                    'Average Score (%)': 95,
                    'Recent Weak Topics': 'None'
                },
                {
                    'Student ID': 'STU005',
                    'Name': 'David Wilson',
                    'Quizzes Attempted': 10,
                    'Average Score (%)': 78,
                    'Recent Weak Topics': 'Chemistry, Equations'
                },
                {
                    'Student ID': 'STU006',
                    'Name': 'Lisa Anderson',
                    'Quizzes Attempted': 14,
                    'Average Score (%)': 89,
                    'Recent Weak Topics': 'Geometry'
                },
                // Additional students for a more comprehensive report
                {
                    'Student ID': 'STU007',
                    'Name': 'Robert Taylor',
                    'Quizzes Attempted': 11,
                    'Average Score (%)': 82,
                    'Recent Weak Topics': 'Trigonometry'
                },
                {
                    'Student ID': 'STU008',
                    'Name': 'Jennifer Martinez',
                    'Quizzes Attempted': 16,
                    'Average Score (%)': 91,
                    'Recent Weak Topics': 'Linear Algebra'
                },
                {
                    'Student ID': 'STU009',
                    'Name': 'Christopher Lee',
                    'Quizzes Attempted': 9,
                    'Average Score (%)': 76,
                    'Recent Weak Topics': 'Calculus, Integration'
                },
                {
                    'Student ID': 'STU010',
                    'Name': 'Amanda White',
                    'Quizzes Attempted': 13,
                    'Average Score (%)': 88,
                    'Recent Weak Topics': 'Statistics'
                }
            ];

            // Create summary data
            const summaryData = [
                {
                    'Metric': 'Total Students',
                    'Value': studentData.length
                },
                {
                    'Metric': 'Average Quiz Attempts',
                    'Value': Math.round(studentData.reduce((sum, student) => sum + student['Quizzes Attempted'], 0) / studentData.length)
                },
                {
                    'Metric': 'Overall Average Score (%)',
                    'Value': Math.round(studentData.reduce((sum, student) => sum + student['Average Score (%)'], 0) / studentData.length)
                },
                {
                    'Metric': 'Students Above 85%',
                    'Value': studentData.filter(student => student['Average Score (%)'] >= 85).length
                },
                {
                    'Metric': 'Students Below 75%',
                    'Value': studentData.filter(student => student['Average Score (%)'] < 75).length
                },
                {
                    'Metric': 'Report Generated',
                    'Value': new Date().toLocaleString()
                }
            ];

            try {
                // Create a new workbook
                const workbook = XLSX.utils.book_new();

                // Create student performance worksheet
                const studentWorksheet = XLSX.utils.json_to_sheet(studentData);
                
                // Create summary worksheet
                const summaryWorksheet = XLSX.utils.json_to_sheet(summaryData);

                // Add worksheets to workbook
                XLSX.utils.book_append_sheet(workbook, studentWorksheet, "Student Performance");
                XLSX.utils.book_append_sheet(workbook, summaryWorksheet, "Summary Report");

                // Generate filename with current date
                const currentDate = new Date();
                const dateString = currentDate.toISOString().split('T')[0]; // YYYY-MM-DD format
                const filename = `Student_Performance_Report_${dateString}.xlsx`;

                // Save the file
                XLSX.writeFile(workbook, filename);

                // Show success notification
                alert(`Excel report "${filename}" downloaded successfully!`, 'success');

            } catch (error) {
                console.error('Error generating Excel file:', error);
                alert('Error generating Excel report. Please try again.', 'error');
            }
        }
    </script>
</body>
</html>
