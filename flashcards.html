<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards - AI Study Platform</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="dashboard-styles.css">
    
    <style>
        .flashcard-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .flashcard {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            margin: 2rem 0;
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            border-radius: 20px;
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        .flashcard-counter {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        .confidence-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .confidence-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .confidence-btn.easy {
            background: #4CAF50;
            color: white;
        }
        
        .confidence-btn.medium {
            background: #FF9800;
            color: white;
        }
        
        .confidence-btn.hard {
            background: #f44336;
            color: white;
        }
        
        .confidence-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .study-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
        }
        
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loader-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        body.dark-mode .flashcard {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }
        
        body.dark-mode .flashcard-back {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }
        
        body.dark-mode .progress-section {
            background: #1f2937;
            color: #e5e7eb;
        }
        
        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #374151, #4b5563);
            color: #e5e7eb;
        }
        
        body.dark-mode .loader-content {
            background: #1f2937;
            color: #e5e7eb;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="student-dashboard.html">
                <i class="fas fa-graduation-cap me-2"></i>
                AI Study Platform
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item me-3">
                    <a class="nav-link" href="#" title="Toggle Dark Mode" onclick="toggleDarkMode()">
                        <i class="fas fa-moon text-light" id="darkModeToggle"></i>
                    </a>
                </div>
                <div class="nav-item">
                    <a class="nav-link" href="student-dashboard.html">
                        <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid" style="margin-top: 80px;">
        <!-- Flashcard Configuration Section -->
        <div id="flashcardConfig" class="flashcard-container">
            <div class="text-center mb-4">
                <h2><i class="fas fa-layer-group me-2"></i>Flashcard Study Session</h2>
                <p class="text-muted">Configure your personalized flashcard experience</p>
            </div>

            <!-- Course Selection -->
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card flashcard-course-config">
                        <div class="card-body text-center p-4">
                            <h5 class="card-title mb-4">
                                <i class="fas fa-book-open me-2"></i>Select Your Study Topic
                            </h5>
                            
                            <form id="flashcardConfigForm">
                                <div class="mb-3">
                                    <label for="flashcardTopic" class="form-label">Topic <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="flashcardTopic" placeholder="Enter study topic (e.g., Spanish Vocabulary, Physics Formulas)" required>
                                    <div class="form-text">Specify the topic you want to study with flashcards</div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="flashcardCount" class="form-label">Number of Cards</label>
                                        <select class="form-select" id="flashcardCount">
                                            <option value="10">10 Cards (Quick Review)</option>
                                            <option value="20" selected>20 Cards (Standard)</option>
                                            <option value="30">30 Cards (Extended)</option>
                                            <option value="50">50 Cards (Intensive)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="flashcardDifficulty" class="form-label">Difficulty Level</label>
                                        <select class="form-select" id="flashcardDifficulty">
                                            <option value="beginner">Beginner</option>
                                            <option value="intermediate" selected>Intermediate</option>
                                            <option value="advanced">Advanced</option>
                                            <option value="mixed">Mixed Levels</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="flashcardType" class="form-label">Study Mode</label>
                                    <select class="form-select" id="flashcardType">
                                        <option value="standard">Standard (Question â†’ Answer)</option>
                                        <option value="reverse">Reverse (Answer â†’ Question)</option>
                                        <option value="mixed" selected>Mixed Mode</option>
                                    </select>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-play me-2"></i>Start Flashcard Session
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flashcard Study Section -->
        <div id="flashcardStudy" class="flashcard-container" style="display: none;">
            <div class="text-center mb-4">
                <h3 id="studyTopicTitle">Studying: <span id="currentTopic"></span></h3>
                <div class="flashcard-counter" id="cardCounter">Card 1 of 20</div>
            </div>

            <!-- Progress Bar -->
            <div class="progress mb-4" style="height: 10px;">
                <div class="progress-bar bg-success" id="studyProgress" role="progressbar" style="width: 5%"></div>
            </div>

            <!-- Flashcard -->
            <div class="flashcard" id="mainFlashcard" onclick="flipCard()">
                <div class="flashcard-face">
                    <div>
                        <div class="flashcard-counter mb-3">Front</div>
                        <h4 id="flashcardFront">Click to start studying!</h4>
                    </div>
                </div>
                <div class="flashcard-face flashcard-back">
                    <div>
                        <div class="flashcard-counter mb-3">Back</div>
                        <h4 id="flashcardBack">Answer will appear here</h4>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="text-center">
                <div class="confidence-buttons" id="confidenceButtons" style="display: none;">
                    <button class="confidence-btn easy" onclick="answerCard('easy')">
                        <i class="fas fa-check-circle me-2"></i>Easy
                    </button>
                    <button class="confidence-btn medium" onclick="answerCard('medium')">
                        <i class="fas fa-minus-circle me-2"></i>Medium
                    </button>
                    <button class="confidence-btn hard" onclick="answerCard('hard')">
                        <i class="fas fa-times-circle me-2"></i>Hard
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="skipCard()">
                        <i class="fas fa-forward me-1"></i>Skip
                    </button>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-outline-secondary me-2" onclick="previousCard()" id="prevBtn" disabled>
                        <i class="fas fa-arrow-left me-1"></i>Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextCard()" id="nextBtn">
                        Next<i class="fas fa-arrow-right ms-1"></i>
                    </button>
                </div>
            </div>

            <!-- Study Progress Section -->
            <div class="progress-section">
                <h5><i class="fas fa-chart-line me-2"></i>Study Progress</h5>
                <div class="study-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="easyCount">0</div>
                        <div>Easy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mediumCount">0</div>
                        <div>Medium</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="hardCount">0</div>
                        <div>Hard</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="notAttemptedCount">0</div>
                        <div>Not Attempted</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCards">0</div>
                        <div>Total</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Section -->
        <div id="flashcardCompletion" class="flashcard-container" style="display: none;">
            <div class="text-center">
                <div class="completion-animation mb-4">
                    <i class="fas fa-trophy text-warning" style="font-size: 4rem;"></i>
                </div>
                <h2>Study Session completed! ðŸŽ‰</h2>
                <p class="lead">Great job! You've completed your flashcard session.</p>
                
                <div class="progress-section">
                    <h5>Session Summary</h5>
                    <div class="study-stats">
                        <div class="stat-card">
                            <div class="stat-number text-success" id="finalEasy">0</div>
                            <div>Easy Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number text-warning" id="finalMedium">0</div>
                            <div>Medium Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number text-danger" id="finalHard">0</div>
                            <div>Hard Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number text-secondary" id="finalNotAttempted">0</div>
                            <div>Not Attempted</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number text-primary" id="finalTotal">0</div>
                            <div>Total Cards</div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <div class="chart-container" style="position: relative; height: 300px; max-width: 500px; margin: 0 auto;">
                            <canvas id="studyChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-primary me-2" onclick="startNewSession()">
                        <i class="fas fa-redo me-2"></i>Study Again
                    </button>
                    <button class="btn btn-outline-primary" onclick="window.location.href='student-dashboard.html'">
                        <i class="fas fa-home me-2"></i>Back to Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loader-overlay" id="loadingOverlay">
        <div class="loader-content">
            <div id="loaderStep1">
                <div class="spinner"></div>
                <h5>Analyzing Study Requirements...</h5>
                <p>Processing your topic and difficulty preferences</p>
            </div>
            <div id="loaderStep2" style="display: none;">
                <div class="spinner"></div>
                <h5>Generating Flashcards...</h5>
                <p>Creating personalized study materials with AI</p>
            </div>
            <div id="loaderStep3" style="display: none;">
                <div class="spinner"></div>
                <h5>Optimizing Study Experience...</h5>
                <p>Preparing adaptive learning sequence</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let currentCardIndex = 0;
        let flashcards = [];
        let studyStats = { easy: 0, medium: 0, hard: 0, notAttempted: 0, total: 0 };
        let isCardFlipped = false;

        // Sample flashcard data
        const sampleFlashcards = {
            'mathematics': [
                { front: 'What is the derivative of sin(x)?', back: 'cos(x)' },
                { front: 'What is the integral of cos(x)?', back: 'sin(x) + C' },
                { front: 'What is the Pythagorean theorem?', back: 'aÂ² + bÂ² = cÂ²' },
                { front: 'What is the quadratic formula?', back: 'x = (-b Â± âˆš(bÂ²-4ac)) / 2a' },
                { front: 'What is the area of a circle?', back: 'Ï€rÂ²' },
                { front: 'What is the limit definition of a derivative?', back: 'lim(hâ†’0) [f(x+h) - f(x)]/h' },
                { front: 'What is the fundamental theorem of calculus?', back: 'If F is an antiderivative of f, then âˆ«[a,b] f(x)dx = F(b) - F(a)' },
                { front: 'What is the slope-intercept form of a line?', back: 'y = mx + b' },
                { front: 'What is the distance formula?', back: 'd = âˆš[(xâ‚‚-xâ‚)Â² + (yâ‚‚-yâ‚)Â²]' },
                { front: 'What is the binomial theorem?', back: '(a+b)â¿ = Î£(k=0 to n) C(n,k)aâ¿â»áµbáµ' }
            ],
            'computer science': [
                { front: 'What is the time complexity of binary search?', back: 'O(log n)' },
                { front: 'What is a hash table?', back: 'A data structure that maps keys to values using a hash function' },
                { front: 'What is the difference between stack and queue?', back: 'Stack is LIFO (Last In, First Out), Queue is FIFO (First In, First Out)' },
                { front: 'What is recursion?', back: 'A function calling itself with a smaller input until reaching a base case' },
                { front: 'What is Big O notation?', back: 'Mathematical notation describing the upper bound of algorithm complexity' },
                { front: 'What is a linked list?', back: 'A linear data structure where elements point to the next element' },
                { front: 'What is the difference between SQL and NoSQL?', back: 'SQL uses structured tables, NoSQL uses flexible document/key-value stores' },
                { front: 'What is machine learning?', back: 'AI technique where computers learn patterns from data without explicit programming' },
                { front: 'What is a neural network?', back: 'Computing system inspired by biological neural networks' },
                { front: 'What is supervised learning?', back: 'ML approach using labeled training data to make predictions' }
            ],
            'physics': [
                { front: 'What is Newton\'s first law?', back: 'An object at rest stays at rest unless acted upon by a force' },
                { front: 'What is the speed of light?', back: '299,792,458 m/s (approximately 3Ã—10â¸ m/s)' },
                { front: 'What is Einstein\'s mass-energy equation?', back: 'E = mcÂ²' },
                { front: 'What is Ohm\'s law?', back: 'V = IR (Voltage = Current Ã— Resistance)' },
                { front: 'What is the universal gravitational constant?', back: 'G = 6.674Ã—10â»Â¹Â¹ mÂ³kgâ»Â¹sâ»Â²' },
                { front: 'What is Planck\'s constant?', back: 'h = 6.626Ã—10â»Â³â´ JÂ·s' },
                { front: 'What is the second law of thermodynamics?', back: 'Entropy of an isolated system never decreases' },
                { front: 'What is Coulomb\'s law?', back: 'F = k(qâ‚qâ‚‚)/rÂ²' },
                { front: 'What is the wave equation for light?', back: 'c = Î»f (speed = wavelength Ã— frequency)' },
                { front: 'What is momentum?', back: 'p = mv (momentum = mass Ã— velocity)' }
            ],
            'programming': [
                { front: 'What does "def" keyword do in Python?', back: 'Defines a function' },
                { front: 'How do you declare a variable in JavaScript?', back: 'let, const, or var keywords' },
                { front: 'What is the difference between == and === in JavaScript?', back: '== compares values, === compares values and types' },
                { front: 'What is a list comprehension in Python?', back: 'Concise way to create lists: [expression for item in iterable]' },
                { front: 'What is the difference between let and const?', back: 'let allows reassignment, const creates immutable binding' },
                { front: 'How do you handle exceptions in Python?', back: 'try-except blocks' },
                { front: 'What is an arrow function in JavaScript?', back: 'Concise function syntax: (params) => expression' },
                { front: 'What is a dictionary in Python?', back: 'Key-value pair data structure: {key: value}' },
                { front: 'What is the DOM?', back: 'Document Object Model - programming interface for web documents' },
                { front: 'What is async/await in JavaScript?', back: 'Syntax for handling asynchronous operations more readably' }
            ],
            'statistics': [
                { front: 'What is the mean?', back: 'The average of all values in a dataset' },
                { front: 'What is the median?', back: 'The middle value when data is arranged in order' },
                { front: 'What is the mode?', back: 'The most frequently occurring value in a dataset' },
                { front: 'What is standard deviation?', back: 'Measure of how spread out data points are from the mean' },
                { front: 'What is correlation?', back: 'Statistical measure of linear relationship between two variables' },
                { front: 'What is a p-value?', back: 'Probability of obtaining results at least as extreme as observed, assuming null hypothesis' },
                { front: 'What is the central limit theorem?', back: 'Sample means approach normal distribution as sample size increases' },
                { front: 'What is a confidence interval?', back: 'Range of values likely to contain the true population parameter' },
                { front: 'What is hypothesis testing?', back: 'Statistical method to test claims about population parameters' },
                { front: 'What is regression analysis?', back: 'Statistical technique to model relationship between dependent and independent variables' }
            ],
            'data science': [
                { front: 'What is data preprocessing?', back: 'Cleaning and transforming raw data for analysis' },
                { front: 'What is overfitting?', back: 'Model performs well on training data but poorly on new data' },
                { front: 'What is cross-validation?', back: 'Technique to assess model performance on multiple data subsets' },
                { front: 'What is feature engineering?', back: 'Creating new features from existing data to improve model performance' },
                { front: 'What is the difference between classification and regression?', back: 'Classification predicts categories, regression predicts continuous values' },
                { front: 'What is a confusion matrix?', back: 'Table showing correct vs predicted classifications' },
                { front: 'What is data visualization?', back: 'Graphical representation of data to reveal patterns and insights' },
                { front: 'What is exploratory data analysis (EDA)?', back: 'Initial investigation of data to discover patterns and anomalies' },
                { front: 'What is the curse of dimensionality?', back: 'Problems that arise when analyzing data in high-dimensional spaces' },
                { front: 'What is A/B testing?', back: 'Experimental method comparing two versions to determine which performs better' }
            ],
            'default': [
                { front: 'What is artificial intelligence?', back: 'The simulation of human intelligence in machines' },
                { front: 'What is machine learning?', back: 'A subset of AI that enables computers to learn without explicit programming' },
                { front: 'What is a neural network?', back: 'A computing system inspired by biological neural networks' },
                { front: 'What is deep learning?', back: 'Machine learning using neural networks with multiple layers' },
                { front: 'What is natural language processing?', back: 'AI that helps computers understand and interpret human language' },
                { front: 'What is the scientific method?', back: 'Systematic approach to understanding the natural world through observation and experimentation' },
                { front: 'What is critical thinking?', back: 'Objective analysis and evaluation of issues to form judgment' },
                { front: 'What is problem-solving?', back: 'Process of finding solutions to difficult or complex issues' },
                { front: 'What is lifelong learning?', back: 'Ongoing, voluntary pursuit of knowledge for personal or professional development' },
                { front: 'What is active learning?', back: 'Educational approach where students engage with material through activities and discussion' }
            ]
        };

        // Initialize flashcard session
        document.getElementById('flashcardConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            startFlashcardSession();
        });

        function startFlashcardSession() {
            const topic = document.getElementById('flashcardTopic').value;
            const count = parseInt(document.getElementById('flashcardCount').value);
            const difficulty = document.getElementById('flashcardDifficulty').value;
            const type = document.getElementById('flashcardType').value;

            showTripleLoader(() => {
                generateFlashcards(topic, count, difficulty, type);
                showStudyInterface(topic, count);
            });
        }

        function showTripleLoader(callback) {
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // Step 1: Analyzing
            setTimeout(() => {
                document.getElementById('loaderStep1').style.display = 'none';
                document.getElementById('loaderStep2').style.display = 'block';
            }, 1500);
            
            // Step 2: Generating
            setTimeout(() => {
                document.getElementById('loaderStep2').style.display = 'none';
                document.getElementById('loaderStep3').style.display = 'block';
            }, 3000);
            
            // Step 3: Optimizing
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                // Reset loader for next time
                document.getElementById('loaderStep3').style.display = 'none';
                document.getElementById('loaderStep1').style.display = 'block';
                callback();
            }, 4500);
        }

        function generateFlashcards(topic, count, difficulty, type) {
            // Determine which set of flashcards to use based on topic or course
            let cardSet = sampleFlashcards.default;
            const topicLower = topic.toLowerCase();
            
            // Check for course-specific keywords
            if (topicLower.includes('math') || topicLower.includes('calculus') || topicLower.includes('algebra')) {
                cardSet = sampleFlashcards.mathematics;
            } else if (topicLower.includes('computer science') || topicLower.includes('algorithm') || topicLower.includes('data structure')) {
                cardSet = sampleFlashcards['computer science'];
            } else if (topicLower.includes('physics') || topicLower.includes('force') || topicLower.includes('energy')) {
                cardSet = sampleFlashcards.physics;
            } else if (topicLower.includes('programming') || topicLower.includes('python') || topicLower.includes('javascript')) {
                cardSet = sampleFlashcards.programming;
            } else if (topicLower.includes('statistics') || topicLower.includes('probability') || topicLower.includes('data analysis')) {
                cardSet = sampleFlashcards.statistics;
            } else if (topicLower.includes('data science') || topicLower.includes('machine learning') || topicLower.includes('ml')) {
                cardSet = sampleFlashcards['data science'];
            }
            
            // Also check the URL course parameter
            const urlParams = new URLSearchParams(window.location.search);
            const course = urlParams.get('course');
            if (course) {
                const courseLower = course.toLowerCase();
                if (courseLower.includes('mathematics')) {
                    cardSet = sampleFlashcards.mathematics;
                } else if (courseLower.includes('computer science')) {
                    cardSet = sampleFlashcards['computer science'];
                } else if (courseLower.includes('physics')) {
                    cardSet = sampleFlashcards.physics;
                } else if (courseLower.includes('programming')) {
                    cardSet = sampleFlashcards.programming;
                } else if (courseLower.includes('statistics')) {
                    cardSet = sampleFlashcards.statistics;
                } else if (courseLower.includes('data science')) {
                    cardSet = sampleFlashcards['data science'];
                }
            }

            // Generate requested number of cards
            flashcards = [];
            for (let i = 0; i < count; i++) {
                const card = cardSet[i % cardSet.length];
                flashcards.push({
                    front: card.front,
                    back: card.back,
                    difficulty: difficulty,
                    answered: false,
                    confidence: null
                });
            }

            // Shuffle if mixed mode
            if (type === 'mixed') {
                flashcards = shuffleArray(flashcards);
            }
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function showStudyInterface(topic, count) {
            document.getElementById('flashcardConfig').style.display = 'none';
            document.getElementById('flashcardStudy').style.display = 'block';
            document.getElementById('currentTopic').textContent = topic;
            document.getElementById('totalCards').textContent = count;
            
            currentCardIndex = 0;
            studyStats = { easy: 0, medium: 0, hard: 0, notAttempted: 0, total: count };
            
            displayCurrentCard();
            updateProgress();
        }

        function displayCurrentCard() {
            if (currentCardIndex >= flashcards.length) {
                showCompletion();
                return;
            }

            const card = flashcards[currentCardIndex];
            document.getElementById('flashcardFront').textContent = card.front;
            document.getElementById('flashcardBack').textContent = card.back;
            document.getElementById('cardCounter').textContent = `Card ${currentCardIndex + 1} of ${flashcards.length}`;
            
            // Reset card state
            document.getElementById('mainFlashcard').classList.remove('flipped');
            document.getElementById('confidenceButtons').style.display = 'none';
            isCardFlipped = false;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentCardIndex === 0;
            document.getElementById('nextBtn').textContent = currentCardIndex === flashcards.length - 1 ? 'Finish' : 'Next';
        }

        function flipCard() {
            const flashcard = document.getElementById('mainFlashcard');
            flashcard.classList.toggle('flipped');
            isCardFlipped = !isCardFlipped;
            
            if (isCardFlipped) {
                document.getElementById('confidenceButtons').style.display = 'flex';
            }
        }

        function answerCard(confidence) {
            flashcards[currentCardIndex].confidence = confidence;
            flashcards[currentCardIndex].answered = true;
            
            // Update stats
            studyStats[confidence]++;
            console.log(`Card answered as ${confidence}. Current stats:`, studyStats);
            updateStats();
            
            // Hide confidence buttons after answering
            document.getElementById('confidenceButtons').style.display = 'none';
            
            // Auto-advance to next card
            setTimeout(() => {
                nextCard();
            }, 500);
        }

        function skipCard() {
            // Mark as skipped but don't count in confidence stats
            flashcards[currentCardIndex].confidence = 'skipped';
            flashcards[currentCardIndex].answered = true;
            
            console.log('Card skipped. Current stats:', studyStats);
            
            // Hide confidence buttons after skipping
            document.getElementById('confidenceButtons').style.display = 'none';
            
            // Auto-advance to next card
            setTimeout(() => {
                nextCard();
            }, 500);
        }

        function nextCard() {
            if (currentCardIndex < flashcards.length - 1) {
                currentCardIndex++;
                displayCurrentCard();
                updateProgress();
            } else {
                showCompletion();
            }
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                displayCurrentCard();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentCardIndex + 1) / flashcards.length) * 100;
            document.getElementById('studyProgress').style.width = progress + '%';
        }

        function updateStats() {
            // Calculate not attempted cards based on current progress
            const attemptedCards = studyStats.easy + studyStats.medium + studyStats.hard;
            const currentNotAttempted = Math.max(0, currentCardIndex + 1 - attemptedCards);
            
            document.getElementById('easyCount').textContent = studyStats.easy;
            document.getElementById('mediumCount').textContent = studyStats.medium;
            document.getElementById('hardCount').textContent = studyStats.hard;
            document.getElementById('notAttemptedCount').textContent = currentNotAttempted;
        }

        function showCompletion() {
            document.getElementById('flashcardStudy').style.display = 'none';
            document.getElementById('flashcardCompletion').style.display = 'block';
            
            // Update final stats
            document.getElementById('finalEasy').textContent = studyStats.easy;
            document.getElementById('finalMedium').textContent = studyStats.medium;
            document.getElementById('finalHard').textContent = studyStats.hard;
            document.getElementById('finalNotAttempted').textContent = studyStats.notAttempted;
            document.getElementById('finalTotal').textContent = flashcards.length;
            
            // Create completion chart with a small delay to ensure DOM is ready
            setTimeout(() => {
                createStudyChart();
            }, 100);
        }

        function createStudyChart() {
            const ctx = document.getElementById('studyChart').getContext('2d');
            
            // Add debugging to see the actual data
            console.log('Study Stats:', studyStats);
            
            // Calculate not attempted cards
            const attemptedCards = studyStats.easy + studyStats.medium + studyStats.hard;
            studyStats.notAttempted = flashcards.length - attemptedCards;
            
            // Update the display
            document.getElementById('finalNotAttempted').textContent = studyStats.notAttempted;
            
            // Handle case where all values are 0 (no cards answered)
            const chartData = [studyStats.easy, studyStats.medium, studyStats.hard, studyStats.notAttempted];
            const hasData = chartData.some(value => value > 0);
            
            if (!hasData) {
                // If no data, show a message instead of empty chart
                const chartContainer = document.getElementById('studyChart').parentElement;
                chartContainer.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-info-circle text-muted mb-2" style="font-size: 2rem;"></i>
                        <p class="text-muted">No confidence ratings recorded during this session.</p>
                    </div>
                `;
                return;
            }
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Easy', 'Medium', 'Hard', 'Not Attempted'],
                    datasets: [{
                        data: chartData,
                        backgroundColor: ['#4CAF50', '#FF9800', '#f44336', '#6c757d'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        title: {
                            display: true,
                            text: 'Study Confidence Distribution',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = chartData.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} cards (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function startNewSession() {
            document.getElementById('flashcardCompletion').style.display = 'none';
            document.getElementById('flashcardConfig').style.display = 'block';
            
            // Reset form
            document.getElementById('flashcardConfigForm').reset();
            document.getElementById('flashcardCount').value = '20';
            document.getElementById('flashcardDifficulty').value = 'intermediate';
            document.getElementById('flashcardType').value = 'mixed';
        }

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            const icon = document.getElementById('darkModeToggle');
            icon.className = isDark ? 'fas fa-sun text-light' : 'fas fa-moon text-light';
            localStorage.setItem('darkMode', isDark);
        }

        // Load dark mode preference and handle URL parameters
        document.addEventListener('DOMContentLoaded', function() {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').className = 'fas fa-sun text-light';
            }
            
            // Check for URL parameters and auto-start session
            const urlParams = new URLSearchParams(window.location.search);
            const course = urlParams.get('course');
            const topic = urlParams.get('topic');
            const count = urlParams.get('count');
            const difficulty = urlParams.get('difficulty');
            const type = urlParams.get('type');
            
            if (course && topic && count && difficulty && type) {
                // Pre-fill the form with URL parameters
                document.getElementById('flashcardTopic').value = topic;
                document.getElementById('flashcardCount').value = count;
                document.getElementById('flashcardDifficulty').value = difficulty;
                document.getElementById('flashcardType').value = type;
                
                // Auto-start the flashcard session
                setTimeout(() => {
                    startFlashcardSessionFromURL(course, topic, count, difficulty, type);
                }, 500);
            }
        });
        
        function startFlashcardSessionFromURL(course, topic, count, difficulty, type) {
            showTripleLoader(() => {
                generateFlashcards(topic, parseInt(count), difficulty, type);
                showStudyInterface(`${course}: ${topic}`, parseInt(count));
            });
        }
    </script>
</body>
</html>